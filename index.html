<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERRACASA 견적 시스템</title>
    
    <!-- 1. Tailwind CSS (디자인 도구) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Lucide Icons (아이콘) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- 3. EmailJS (이메일 발송) -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .text-tc-olive { color: #4A5D23; }
        .bg-tc-olive { background-color: #4A5D23; }
        .ring-tc-olive { --tw-ring-color: #4A5D23; }
        .hidden { display: none !important; }
        
        /* 인쇄 및 모달 스타일 */
        @media print {
            body > * { display: none !important; }
            #result-modal, #result-modal * { display: block !important; visibility: visible !important; }
            #result-modal { 
                position: absolute !important; 
                left: 0 !important; 
                top: 0 !important; 
                width: 100% !important; 
                height: auto !important; 
                background: white !important;
                box-shadow: none !important;
                padding: 0 !important;
                border: none !important;
            }
            #modal-overlay { background: none !important; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <!-- 메인 컨테이너 -->
    <div id="main-container" class="bg-white w-full max-w-xl rounded-2xl shadow-xl overflow-hidden min-h-[600px] flex flex-col relative print:hidden">
        
        <!-- 헤더 -->
        <div class="bg-white border-b p-4 flex justify-between items-center">
            <h1 class="text-lg font-extrabold text-tc-olive tracking-wide">TERRACASA ESTIMATE</h1>
            <div class="text-xs font-bold text-gray-400 bg-gray-100 px-2 py-1 rounded">Step <span id="current-step-num">1</span> / 6</div>
        </div>

        <!-- 진행바 -->
        <div class="w-full h-1 bg-gray-100">
            <div id="progress-bar" class="h-full bg-tc-olive transition-all duration-300 ease-out" style="width: 16.6%;"></div>
        </div>

        <!-- 콘텐츠 영역 -->
        <div id="steps-container" class="flex-1 p-6 md:p-8 overflow-y-auto">
            
            <!-- STEP 1: 기본 정보 -->
            <div id="step-1" class="step-content">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-6">
                    <i data-lucide="phone" class="text-tc-olive"></i> 기본 정보 입력
                </h2>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r mb-6">
                    <div class="flex items-start">
                        <i data-lucide="alert-triangle" class="h-5 w-5 text-yellow-600 mr-2 mt-0.5 flex-shrink-0"></i>
                        <p class="text-sm text-yellow-700 font-bold ml-2">
                            안내: 타인의 전화번호를 도용하여 견적을 산출할 경우 법적인 책임이 따를 수 있습니다. 반드시 본인의 휴대전화 번호를 입력해주세요.
                        </p>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">휴대폰 번호</label>
                    <input type="tel" id="input-phone" placeholder="010-0000-0000" maxlength="13"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tc-olive outline-none transition">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">시/도</label>
                        <select id="input-region-do" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tc-olive outline-none bg-white">
                            <option value="">선택</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">시/군/구</label>
                        <select id="input-region-si" disabled class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-tc-olive outline-none bg-white disabled:bg-gray-100">
                            <option value="">선택</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- STEP 2: 고객 구분 -->
            <div id="step-2" class="step-content hidden">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-2">
                    <i data-lucide="user" class="text-tc-olive"></i> 고객 구분
                </h2>
                <p class="text-sm text-gray-500 mb-6">정확한 상담 배정을 위해 고객 유형을 선택해주세요.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="user-type-options"></div>
            </div>

            <!-- STEP 3: 시공 시기 -->
            <div id="step-3" class="step-content hidden">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-6">
                    <i data-lucide="calendar" class="text-tc-olive"></i> 시공 예정 시기
                </h2>
                <div class="grid grid-cols-1 gap-3" id="timeline-options"></div>
            </div>

            <!-- STEP 4: 양중 환경 -->
            <div id="step-4" class="step-content hidden">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-2">
                    <i data-lucide="truck" class="text-tc-olive"></i> 자재 반입 환경 (양중)
                </h2>
                <p class="text-sm text-gray-500 mb-6">설치 장소로 자재를 옮길 수 있는 가장 유사한 방법을 선택해주세요.</p>
                <div class="grid grid-cols-1 gap-3" id="lifting-options"></div>
            </div>

            <!-- STEP 5: 제품 사양 -->
            <div id="step-5" class="step-content hidden">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-6">
                    <i data-lucide="ruler" class="text-tc-olive"></i> 제품 사양 및 사이즈
                </h2>
                
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div id="op-manual" class="cursor-pointer p-4 rounded-xl border-2 transition-all relative overflow-hidden border-gray-200 hover:border-gray-300">
                        <div class="flex justify-between items-center mb-2 relative z-10">
                            <span class="font-bold text-lg">수동 (Manual)</span>
                            <i data-lucide="sun" class="text-orange-400"></i>
                        </div>
                        <ul class="text-xs text-gray-600 space-y-1 relative z-10">
                            <li class="text-blue-600 font-semibold">✔ 경제적인 가격</li>
                            <li>✖ LED 옵션 설치 어려움</li>
                            <li>✖ 글라스 도어 설치 제한</li>
                        </ul>
                    </div>
                    <div id="op-electric" class="cursor-pointer p-4 rounded-xl border-2 transition-all relative overflow-hidden border-gray-200 hover:border-gray-300">
                        <div class="flex justify-between items-center mb-2 relative z-10">
                            <span class="font-bold text-lg text-tc-olive">전동 (Electric)</span>
                            <i data-lucide="zap" class="text-yellow-500"></i>
                        </div>
                        <ul class="text-xs text-gray-600 space-y-1 relative z-10">
                            <li>✔ 리모컨 작동 편리함</li>
                            <li class="text-blue-600 font-semibold">✔ LED 조명 옵션 가능</li>
                            <li class="text-blue-600 font-semibold">✔ 글라스 도어 호환 우수</li>
                        </ul>
                    </div>
                </div>

                <div class="bg-gray-50 p-6 rounded-2xl border border-gray-200 mb-6">
                    <h3 class="font-bold text-gray-700 mb-4 flex items-center gap-2">
                        <i data-lucide="mouse-pointer-click" class="text-tc-olive"></i> 설치 공간 사이즈 (단위: m)
                    </h3>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-semibold text-gray-500 mb-2 ml-1">가로 (Width)</label>
                            <div class="relative">
                                <input type="number" id="input-width" placeholder="예: 4" step="0.1"
                                    class="w-full p-4 pr-10 border border-gray-300 rounded-xl focus:border-tc-olive outline-none text-2xl font-bold text-center bg-white shadow-sm">
                                <span class="absolute right-4 top-5 text-gray-400 font-bold">m</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-500 mb-2 ml-1">세로/돌출 (Projection)</label>
                            <div class="relative">
                                <input type="number" id="input-projection" placeholder="예: 3" step="0.1"
                                    class="w-full p-4 pr-10 border border-gray-300 rounded-xl focus:border-tc-olive outline-none text-2xl font-bold text-center bg-white shadow-sm">
                                <span class="absolute right-4 top-5 text-gray-400 font-bold">m</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 6: 옵션 -->
            <div id="step-6" class="step-content hidden">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-6">
                    <i data-lucide="check-circle" class="text-tc-olive"></i> 추가 옵션 선택
                </h2>
                
                <label id="card-led" class="relative flex items-start gap-4 p-4 rounded-xl border-2 cursor-pointer transition-all border-gray-200 hover:border-gray-300 mb-4">
                    <div class="flex-shrink-0 mt-1">
                        <input type="checkbox" id="check-led" class="w-5 h-5 accent-tc-olive">
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-gray-800 text-lg">LED 조명 추가</span>
                            <i data-lucide="lightbulb" class="text-gray-300 icon-led"></i>
                        </div>
                        <p class="text-sm text-gray-500">야간에도 분위기 있는 테라스를 즐겨보세요.</p>
                        <p id="msg-manual-led" class="mt-2 text-xs text-red-500 bg-red-50 p-2 rounded font-bold hidden">⚠️ 수동 모델은 LED 설치 시 별도 배선 비용이 크게 발생합니다. (전동 추천)</p>
                    </div>
                </label>

                <div id="card-glass" class="p-4 rounded-xl border-2 transition-all border-red-300 bg-red-50 mb-4">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-2">
                            <i data-lucide="door-open" class="text-red-400 icon-glass"></i>
                            <span class="font-bold text-gray-800 text-lg">글라스 도어 (폴딩/슬라이딩)</span>
                        </div>
                        <span id="badge-glass-req" class="text-xs text-red-500 font-bold animate-pulse">❗필수 선택</span>
                    </div>
                    <div class="grid grid-cols-3 gap-2" id="glass-options">
                        <!-- JS로 버튼 생성 -->
                    </div>
                    <p id="msg-manual-glass" class="mt-3 text-xs text-orange-600 bg-orange-50 p-2 rounded font-bold hidden">💡 수동 핸들 간섭으로 인해 글라스 도어 설치가 제한될 수 있습니다.</p>
                </div>

                <label id="card-deck" class="relative flex items-start gap-4 p-4 rounded-xl border-2 cursor-pointer transition-all border-gray-200 hover:border-gray-300">
                    <div class="flex-shrink-0 mt-1">
                        <input type="checkbox" id="check-deck" class="w-5 h-5 accent-tc-olive">
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-gray-800 text-lg">바닥 데크 시공 의뢰</span>
                            <i data-lucide="hammer" class="text-gray-300 icon-deck"></i>
                        </div>
                        <p class="text-sm text-gray-500">합성목재 또는 방부목 데크 시공 견적도 함께 받아봅니다.</p>
                    </div>
                </label>

                <div class="pt-4 mt-4">
                    <div class="flex items-start gap-2 text-xs text-gray-500 bg-gray-50 p-3 rounded">
                        <i data-lucide="info" class="w-4 h-4 mt-0.5 flex-shrink-0"></i>
                        <p>'견적 확인하기'를 누르시면 <span class="font-bold text-gray-700">개인정보 수집 및 마케팅 활용</span>에 동의하는 것으로 간주되며, 입력하신 정보가 담당자에게 전송됩니다.</p>
                    </div>
                </div>
            </div>

            <!-- 에러 메시지 -->
            <div id="error-msg" class="p-3 bg-red-100 text-red-600 rounded-lg text-center font-bold animate-pulse hidden mt-4"></div>
        </div>

        <!-- 푸터 (버튼) -->
        <div class="p-4 bg-white border-t space-y-3">
            <div class="flex gap-3">
                <button id="btn-prev" class="flex-1 py-3 rounded-xl border border-gray-300 font-bold text-gray-500 hover:bg-gray-50 transition hidden">이전</button>
                <button id="btn-next" class="flex-1 py-3 rounded-xl bg-tc-olive text-white font-bold text-lg hover:bg-opacity-90 transition flex justify-center items-center gap-2">
                    다음 <i data-lucide="chevron-right"></i>
                </button>
                <button id="btn-submit" class="flex-1 py-3 rounded-xl bg-tc-olive text-white font-bold text-lg hover:bg-opacity-90 transition flex justify-center items-center gap-2 hidden">
                    견적 확인하기 <i data-lucide="calculator"></i>
                </button>
            </div>
        </div>

        <!-- 결과 모달 -->
        <div id="modal-overlay" class="absolute inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
            <div id="result-modal" class="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto">
                <div class="bg-tc-olive p-6 text-white text-center print:border-b-2 print:border-black print:text-black print:bg-white">
                    <h2 class="text-3xl font-black mb-1">TERRACASA</h2>
                    <p class="text-sm opacity-90 font-medium">SMART QUOTATION SYSTEM</p>
                </div>
                
                <div class="p-6 space-y-6">
                    <div class="text-center border-b pb-6 border-gray-100 print:border-black">
                        <p class="text-sm text-gray-500 mb-1">총 예상 견적가 (VAT 별도)</p>
                        <p class="text-4xl font-black text-gray-800 tracking-tight" id="result-total-price">0원~</p>
                    </div>

                    <!-- 방향 최적화 메시지 -->
                    <div id="result-swapped-msg" class="bg-green-50 p-4 rounded-xl border border-green-200 text-sm text-green-800 mb-4 flex items-start gap-2 hidden">
                        <i data-lucide="rotate-cw" class="w-5 h-5 flex-shrink-0 mt-0.5 text-green-600"></i>
                        <div>
                            <span class="font-bold">가로/세로 방향 자동 최적화 적용됨</span>
                            <p class="mt-1" id="result-swapped-text"></p>
                        </div>
                    </div>

                    <!-- 사이즈 제한(Cap) 메시지 -->
                    <div id="result-cap-msg" class="bg-red-50 p-4 rounded-xl border border-red-200 text-sm text-red-800 mb-4 hidden">
                        <p class="font-bold mb-1 flex items-center gap-1"><i data-lucide="alert-triangle" class="w-4 h-4"></i> 사이즈 안내</p>
                        <div id="result-cap-text" class="mb-2">
                            제품 1개소 기준 최대사이즈를 초과하여 최대사이즈 기준으로 견적을 산출했습니다.
                        </div>
                    </div>

                    <!-- 옵션 미포함 안내 (추가) -->
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-200 text-sm text-blue-800 mb-4 flex items-start gap-2">
                        <i data-lucide="info" class="w-5 h-5 flex-shrink-0 mt-0.5 text-blue-600"></i>
                        <p><strong>데크, 글라스도어의 경우</strong> 상담후 견적안내를 하고있으며 해당 견적에는 포함되어있지 않습니다.</p>
                    </div>

                    <div class="space-y-3 text-sm" id="result-details">
                        <!-- JS로 채움 -->
                    </div>

                    <div class="bg-gray-50 p-4 rounded-xl text-xs text-gray-500 space-y-1 print:bg-white print:border print:border-gray-200">
                        <p class="font-bold text-gray-700 mb-1">※ 유의사항</p>
                        <p>1. 자동견적 프로그램에 지역별 출장비는 반영되어있지 않습니다.</p>
                        <p>2. 운임의 경우 제품의 개소에 따라 추가 부과 될 수 있습니다.</p>
                        <p>3. 데크, 글라스도어의 경우 상담후 견적안내를 하고있으며 해당 견적에는 포함되어있지 않습니다.</p>
                        <p>• 위 금액은 가견적이며 현장 상황에 따라 변동될 수 있습니다.</p>
                        <p>• 정확한 견적을 위해 담당자가 3일 이내로 연락드릴 예정입니다.</p>
                        <p>• 글라스 도어 및 데크 시공비는 현장 실측 후 정확히 산출됩니다.</p>
                    </div>

                    <div class="grid grid-cols-3 gap-2 no-print pt-4">
                        <button id="btn-modal-close" class="flex flex-col items-center justify-center p-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
                            <i data-lucide="rotate-ccw" class="w-5 h-5 mb-1 rotate-90"></i>
                            <span class="text-xs font-bold">이전으로</span>
                        </button>
                        <button id="btn-modal-reset" class="flex flex-col items-center justify-center p-3 rounded-xl bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
                            <i data-lucide="x" class="w-5 h-5 mb-1"></i>
                            <span class="text-xs font-bold">종료하기</span>
                        </button>
                        <button type="button" id="btn-modal-print" class="flex flex-col items-center justify-center p-3 rounded-xl bg-tc-olive text-white hover:bg-green-800 transition shadow-lg">
                            <i data-lucide="download" class="w-5 h-5 mb-1"></i>
                            <span class="text-xs font-bold">견적서 저장</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 스크립트 로직 (순수 JavaScript) -->
    <script>
        // ================= 설정 =================
        const EMAILJS_SERVICE_ID = "service_r3nil9k";
        const EMAILJS_TEMPLATE_ID = "template_2lqnkam";
        const EMAILJS_PUBLIC_KEY = "uqikvD1GCoxfF_h69";

        // ================= 데이터 =================
        const oasisManualPriceTable = {
            2600: [3200000, 3400000, 3600000, 3800000, 4000000, 4200000, 4400000],
            2775: [3240000, 3450000, 3660000, 3870000, 4080000, 4290000, 4500000],
            2950: [3280000, 3500000, 3720000, 3940000, 4160000, 4380000, 4600000],
            3125: [3320000, 3550000, 3780000, 4010000, 4240000, 4470000, 4700000],
            3300: [3360000, 3600000, 3840000, 4080000, 4320000, 4560000, 4800000],
            3475: [3400000, 3650000, 3900000, 4150000, 4400000, 4650000, 4900000],
            3650: [3440000, 3700000, 3960000, 4220000, 4480000, 4740000, 5000000],
            3825: [3480000, 3750000, 4020000, 4290000, 4560000, 4830000, 5100000],
            4000: [3520000, 3800000, 4080000, 4360000, 4640000, 4920000, 5200000],
            4175: [3560000, 3850000, 4140000, 4430000, 4720000, 5010000, 5300000],
            4350: [3600000, 3900000, 4200000, 4500000, 4800000, 5100000, 5400000],
            4525: [3640000, 3950000, 4260000, 4570000, 4880000, 5190000, 5500000],
            4700: [3680000, 4000000, 4320000, 4640000, 4960000, 5280000, 5600000],
            4875: [3720000, 4050000, 4380000, 4710000, 5040000, 5370000, 5700000],
            5050: [3760000, 4100000, 4440000, 4780000, 5120000, 5460000, 5800000],
            5225: [3800000, 4150000, 4500000, 4850000, 5200000, 5550000, 5900000],
            5400: [3840000, 4200000, 4560000, 4920000, 5280000, 5640000, 6000000],
            5575: [3880000, 4250000, 4620000, 4990000, 5360000, 5730000, 6100000],
            5750: [3920000, 4300000, 4680000, 5060000, 5440000, 5820000, 6200000],
            5925: [3960000, 4350000, 4740000, 5130000, 5520000, 5910000, 6300000]
        };

        const oasisElectricPriceTable = {
            2600: [3600000, 3850000, 4100000, 4350000, 4600000, 4850000, 5100000],
            2775: [3640000, 3900000, 4160000, 4420000, 4680000, 4940000, 5200000],
            2950: [3680000, 3950000, 4220000, 4490000, 4760000, 5030000, 5300000],
            3125: [3720000, 4000000, 4280000, 4560000, 4840000, 5120000, 5400000],
            3300: [3760000, 4050000, 4340000, 4630000, 4920000, 5210000, 5500000],
            3475: [3800000, 4100000, 4400000, 4700000, 5000000, 5300000, 5600000],
            3650: [3840000, 4150000, 4460000, 4770000, 5080000, 5390000, 5700000],
            3825: [3880000, 4200000, 4520000, 4840000, 5160000, 5480000, 5800000],
            4000: [3920000, 4250000, 4580000, 4910000, 5240000, 5570000, 5900000],
            4175: [3960000, 4300000, 4640000, 4980000, 5320000, 5660000, 6000000],
            4350: [4000000, 4350000, 4700000, 5050000, 5400000, 5750000, 6100000],
            4525: [4040000, 4400000, 4760000, 5120000, 5480000, 5840000, 6200000],
            4700: [4080000, 4450000, 4820000, 5190000, 5560000, 5930000, 6300000],
            4875: [4120000, 4500000, 4880000, 5260000, 5640000, 6020000, 6400000],
            5050: [4160000, 4550000, 4940000, 5330000, 5720000, 6110000, 6500000],
            5225: [4200000, 4600000, 5000000, 5400000, 5800000, 6200000, 6600000],
            5400: [4240000, 4650000, 5060000, 5470000, 5880000, 6290000, 6700000],
            5575: [4280000, 4700000, 5120000, 5540000, 5960000, 6380000, 6800000],
            5750: [4320000, 4750000, 5180000, 5610000, 6040000, 6470000, 6900000],
            5925: [4360000, 4800000, 5240000, 5680000, 6120000, 6560000, 7000000]
        };

        const regions = {
            '서울특별시': ['강남구', '강동구', '강북구', '강서구', '관악구', '광진구', '구로구', '금천구', '노원구', '도봉구', '동대문구', '동작구', '마포구', '서대문구', '서초구', '성동구', '성북구', '송파구', '양천구', '영등포구', '용산구', '은평구', '종로구', '중구', '중랑구'],
            '부산광역시': ['강서구', '금정구', '기장군', '남구', '동구', '동래구', '부산진구', '북구', '사상구', '사하구', '서구', '수영구', '연제구', '영도구', '중구', '해운대구'],
            '대구광역시': ['군위군', '남구', '달서구', '달성군', '동구', '북구', '서구', '수성구', '중구'],
            '인천광역시': ['강화군', '계양구', '남동구', '동구', '미추홀구', '부평구', '서구', '연수구', '옹진군', '중구'],
            '광주광역시': ['광산구', '남구', '동구', '북구', '서구'],
            '대전광역시': ['대덕구', '동구', '서구', '유성구', '중구'],
            '울산광역시': ['남구', '동구', '북구', '울주군', '중구'],
            '세종특별자치시': ['세종시'],
            '경기도': ['가평군', '고양시', '과천시', '광명시', '광주시', '구리시', '군포시', '김포시', '남양주시', '동두천시', '부천시', '성남시', '수원시', '시흥시', '안산시', '안성시', '안양시', '양주시', '양평군', '여주시', '연천군', '오산시', '용인시', '의왕시', '의정부시', '이천시', '파주시', '평택시', '포천시', '하남시', '화성시'],
            '강원특별자치도': ['강릉시', '고성군', '동해시', '삼척시', '속초시', '양구군', '양양군', '영월군', '원주시', '인제군', '정선군', '철원군', '춘천시', '태백시', '평창군', '홍천군', '화천군', '횡성군'],
            '충청북도': ['괴산군', '단양군', '보은군', '영동군', '옥천군', '음성군', '제천시', '증평군', '진천군', '청주시', '충주시'],
            '충청남도': ['계룡시', '공주시', '금산군', '논산시', '당진시', '보령시', '부여군', '서산시', '서천군', '아산시', '예산군', '천안시', '청양군', '태안군', '홍성군'],
            '전북특별자치도': ['고창군', '군산시', '김제시', '남원시', '무주군', '부안군', '순창군', '완주군', '익산시', '임실군', '장수군', '전주시', '정읍시', '진안군'],
            '전라남도': ['강진군', '고흥군', '곡성군', '광양시', '구례군', '나주시', '담양군', '목포시', '무안군', '보성군', '순천시', '신안군', '여수시', '영광군', '영암군', '완도군', '장성군', '장흥군', '진도군', '함평군', '해남군', '화순군'],
            '경상북도': ['경산시', '경주시', '고령군', '구미시', '김천시', '문경시', '봉화군', '상주시', '성주군', '안동시', '영덕군', '영양군', '영주시', '영천시', '예천군', '울릉군', '울진군', '의성군', '청도군', '청송군', '칠곡군', '포항시'],
            '경상남도': ['거제시', '거창군', '고성군', '김해시', '남해군', '밀양시', '사천시', '산청군', '양산시', '의령군', '진주시', '창녕군', '창원시', '통영시', '하동군', '함안군', '함양군', '합천군'],
            '제주특별자치도': ['서귀포시', '제주시']
        };

        // ================= 상태 관리 =================
        let currentStep = 1;
        let formData = {
            phone: '',
            regionDo: '',
            regionSi: '',
            userType: '',
            timeline: '',
            liftingType: '',
            operationType: '',
            width: '',
            projection: '',
            optionLed: false,
            optionGlass: '',
            optionDeck: false
        };

        // ================= 초기화 및 이벤트 =================
        window.onload = function() {
            if (window.emailjs) {
                emailjs.init(EMAILJS_PUBLIC_KEY);
            }
            
            // 아이콘 렌더링
            lucide.createIcons();

            // 지역 채우기
            const regionDoSelect = document.getElementById('input-region-do');
            Object.keys(regions).forEach(r => {
                const option = document.createElement('option');
                option.value = r;
                option.text = r;
                regionDoSelect.appendChild(option);
            });

            // 옵션 생성
            createButtons('user-type-options', ['개인 고객', '인테리어 업체', '조경 업체', '건축/설계사', '관공서/기업'], 'userType');
            createButtonsWithValues('timeline-options', [
                {label: '1개월 이내 (긴급)', val: 'urgent'},
                {label: '3개월 이내 (보통)', val: 'normal'},
                {label: '6개월 이내 (여유)', val: 'relaxed'},
                {label: '6개월 이후 / 계획단계', val: 'planning'}
            ], 'timeline');
            createButtonsWithValues('lifting-options', [
                { label: '즉시 진입 가능', desc: '1층 / 화물차 하차 후 즉시 진입', val: 'direct_entry', icon: 'arrow-right-from-line'},
                { label: '사다리차 사용', desc: '1층 이상 / 진입로 협소', val: 'ladder', icon: 'arrow-up-to-line'},
                { label: '크레인 사용', desc: '고층 / 대형 장비 필요', val: 'crane', icon: 'construction'},
                { label: '자재 소운반 (20m+)', desc: '하차 후 20m 이상 인력 운반', val: 'long_carry', icon: 'footprints'},
                { label: '잘 모르겠음', desc: '현장 확인 필요', val: 'unknown', icon: 'help-circle'}
            ], 'liftingType');

            // Glass 옵션
            const glassContainer = document.getElementById('glass-options');
            [
                { val: 'none', label: '설치 안함' },
                { val: 'with', label: '함께 시공 (추천)' },
                { val: 'later', label: '추후 예정' }
            ].forEach(opt => {
                const btn = document.createElement('button');
                btn.className = `py-2 rounded-lg text-sm font-medium transition-all bg-white border border-gray-300 text-gray-600 hover:bg-gray-50 glass-btn`;
                btn.dataset.value = opt.val;
                btn.textContent = opt.label;
                btn.onclick = () => {
                    formData.optionGlass = opt.val;
                    updateGlassUI();
                    document.getElementById('error-msg').classList.add('hidden');
                };
                glassContainer.appendChild(btn);
            });

            // 이벤트 핸들러
            document.getElementById('btn-next').onclick = nextStep;
            document.getElementById('btn-prev').onclick = prevStep;
            document.getElementById('btn-submit').onclick = calculateQuote;
            
            document.getElementById('input-phone').oninput = (e) => {
                let val = e.target.value.replace(/[^0-9]/g, '');
                if (val.length > 3 && val.length <= 7) val = val.slice(0,3) + '-' + val.slice(3);
                else if (val.length > 7) val = val.slice(0,3) + '-' + val.slice(3,7) + '-' + val.slice(7, 11);
                e.target.value = val;
                formData.phone = val;
                clearError();
            };

            document.getElementById('input-region-do').onchange = (e) => {
                formData.regionDo = e.target.value;
                formData.regionSi = '';
                updateRegionSi();
                clearError();
            };

            document.getElementById('input-region-si').onchange = (e) => {
                formData.regionSi = e.target.value;
                clearError();
            };

            document.getElementById('op-manual').onclick = () => setOperation('manual');
            document.getElementById('op-electric').onclick = () => setOperation('electric');
            document.getElementById('input-width').oninput = (e) => formData.width = e.target.value;
            document.getElementById('input-projection').oninput = (e) => formData.projection = e.target.value;

            document.getElementById('check-led').onchange = (e) => {
                formData.optionLed = e.target.checked;
                updateLedUI();
            };
            document.getElementById('check-deck').onchange = (e) => {
                formData.optionDeck = e.target.checked;
                updateDeckUI();
            };

            document.getElementById('btn-modal-close').onclick = closeModal;
            document.getElementById('btn-modal-reset').onclick = () => window.location.reload();
            document.getElementById('btn-modal-print').onclick = () => window.print();
        };

        // ================= UI Helper Functions =================

        function createButtons(containerId, options, field) {
            const container = document.getElementById(containerId);
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = `p-4 rounded-xl border-2 text-left transition-all border-gray-200 hover:border-tc-olive hover:bg-gray-50 option-btn-${field}`;
                btn.textContent = opt;
                btn.onclick = () => {
                    formData[field] = opt;
                    document.querySelectorAll(`.option-btn-${field}`).forEach(b => {
                        b.classList.remove('border-tc-olive', 'bg-green-50', 'text-tc-olive', 'font-bold', 'shadow-md');
                        b.classList.add('border-gray-200');
                    });
                    btn.classList.remove('border-gray-200');
                    btn.classList.add('border-tc-olive', 'bg-green-50', 'text-tc-olive', 'font-bold', 'shadow-md');
                    clearError();
                    setTimeout(() => nextStep(), 250);
                };
                container.appendChild(btn);
            });
        }

        function createButtonsWithValues(containerId, options, field) {
            const container = document.getElementById(containerId);
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = `p-4 rounded-xl border-2 text-left transition-all flex items-center gap-4 group border-gray-200 hover:border-tc-olive hover:bg-gray-50 option-btn-${field}`;
                
                let innerHTML = '';
                if(opt.icon) {
                    innerHTML += `<div class="flex-shrink-0 p-2 rounded-full border border-gray-100 shadow-sm bg-gray-50 text-gray-400 group-hover:text-tc-olive icon-box"><i data-lucide="${opt.icon}"></i></div>`;
                }
                innerHTML += `<div><div class="font-bold text-lg label-text text-gray-800">${opt.label}</div>`;
                if(opt.desc) innerHTML += `<div class="text-sm text-gray-500">${opt.desc}</div>`;
                innerHTML += `</div>`;
                
                btn.innerHTML = innerHTML;
                btn.onclick = () => {
                    formData[field] = opt.val;
                    document.querySelectorAll(`.option-btn-${field}`).forEach(b => {
                        b.classList.remove('border-tc-olive', 'bg-green-50', 'ring-1', 'ring-tc-olive');
                        b.classList.add('border-gray-200');
                        const iconBox = b.querySelector('.icon-box');
                        const labelText = b.querySelector('.label-text');
                        if(iconBox) iconBox.classList.replace('bg-white', 'bg-gray-50');
                        if(iconBox) iconBox.classList.replace('text-tc-olive', 'text-gray-400');
                        if(labelText) labelText.classList.replace('text-tc-olive', 'text-gray-800');
                    });
                    btn.classList.remove('border-gray-200');
                    btn.classList.add('border-tc-olive', 'bg-green-50', 'ring-1', 'ring-tc-olive');
                    const iconBox = btn.querySelector('.icon-box');
                    const labelText = btn.querySelector('.label-text');
                    if(iconBox) iconBox.classList.replace('bg-gray-50', 'bg-white');
                    if(iconBox) iconBox.classList.replace('text-gray-400', 'text-tc-olive');
                    if(labelText) labelText.classList.replace('text-gray-800', 'text-tc-olive');

                    clearError();
                    setTimeout(() => nextStep(), 250);
                };
                container.appendChild(btn);
            });
            lucide.createIcons();
        }

        function updateRegionSi() {
            const siSelect = document.getElementById('input-region-si');
            siSelect.innerHTML = '<option value="">선택</option>';
            if (formData.regionDo && regions[formData.regionDo]) {
                regions[formData.regionDo].forEach(s => {
                    const option = document.createElement('option');
                    option.value = s;
                    option.text = s;
                    siSelect.appendChild(option);
                });
                siSelect.disabled = false;
                siSelect.classList.remove('disabled:bg-gray-100');
            } else {
                siSelect.disabled = true;
                siSelect.classList.add('disabled:bg-gray-100');
            }
        }

        function setOperation(type) {
            formData.operationType = type;
            const manualDiv = document.getElementById('op-manual');
            const electricDiv = document.getElementById('op-electric');
            
            [manualDiv, electricDiv].forEach(d => {
                d.classList.remove('border-tc-olive', 'bg-green-50', 'ring-2', 'ring-tc-olive', 'ring-opacity-50');
                d.classList.add('border-gray-200');
            });

            const target = type === 'manual' ? manualDiv : electricDiv;
            target.classList.remove('border-gray-200');
            target.classList.add('border-tc-olive', 'bg-green-50', 'ring-2', 'ring-tc-olive', 'ring-opacity-50');
            
            updateLedUI();
            updateGlassUI();
            clearError();
        }

        function updateLedUI() {
            const card = document.getElementById('card-led');
            const icon = card.querySelector('.icon-led');
            const msg = document.getElementById('msg-manual-led');

            if (formData.optionLed) {
                card.classList.add('border-tc-olive', 'bg-green-50', 'ring-1', 'ring-tc-olive');
                card.classList.remove('border-gray-200');
                icon.classList.add('text-yellow-500', 'fill-yellow-500');
                icon.classList.remove('text-gray-300');
            } else {
                card.classList.remove('border-tc-olive', 'bg-green-50', 'ring-1', 'ring-tc-olive');
                card.classList.add('border-gray-200');
                icon.classList.remove('text-yellow-500', 'fill-yellow-500');
                icon.classList.add('text-gray-300');
            }

            if (formData.operationType === 'manual' && formData.optionLed) {
                msg.classList.remove('hidden');
            } else {
                msg.classList.add('hidden');
            }
        }

        function updateGlassUI() {
            const card = document.getElementById('card-glass');
            const icon = card.querySelector('.icon-glass');
            const badge = document.getElementById('badge-glass-req');
            const msg = document.getElementById('msg-manual-glass');
            const btns = document.querySelectorAll('.glass-btn');

            if (formData.optionGlass !== '') {
                card.classList.add('border-tc-olive', 'bg-green-50', 'ring-1', 'ring-tc-olive');
                card.classList.remove('border-red-300', 'bg-red-50');
                icon.classList.replace('text-red-400', 'text-blue-500');
                badge.classList.add('hidden');
            }

            btns.forEach(btn => {
                if (btn.dataset.value === formData.optionGlass) {
                    btn.classList.add('bg-tc-olive', 'text-white', 'shadow-md');
                    btn.classList.remove('bg-white', 'text-gray-600');
                } else {
                    btn.classList.remove('bg-tc-olive', 'text-white', 'shadow-md');
                    btn.classList.add('bg-white', 'text-gray-600');
                }
            });

            if (formData.operationType === 'manual' && formData.optionGlass !== '' && formData.optionGlass !== 'none') {
                msg.classList.remove('hidden');
            } else {
                msg.classList.add('hidden');
            }
        }

        function updateDeckUI() {
            const card = document.getElementById('card-deck');
            const icon = card.querySelector('.icon-deck');
            if (formData.optionDeck) {
                card.classList.add('border-tc-olive', 'bg-green-50', 'ring-1', 'ring-tc-olive');
                card.classList.remove('border-gray-200');
                icon.classList.replace('text-gray-300', 'text-brown-500');
            } else {
                card.classList.remove('border-tc-olive', 'bg-green-50', 'ring-1', 'ring-tc-olive');
                card.classList.add('border-gray-200');
                icon.classList.replace('text-brown-500', 'text-gray-300');
            }
        }

        function updateStepUI() {
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`step-${currentStep}`).classList.remove('hidden');
            
            document.getElementById('current-step-num').textContent = currentStep;
            document.getElementById('progress-bar').style.width = `${(currentStep / 6) * 100}%`;

            if (currentStep === 1) document.getElementById('btn-prev').classList.add('hidden');
            else document.getElementById('btn-prev').classList.remove('hidden');

            if (currentStep === 6) {
                document.getElementById('btn-next').classList.add('hidden');
                document.getElementById('btn-submit').classList.remove('hidden');
            } else {
                document.getElementById('btn-next').classList.remove('hidden');
                document.getElementById('btn-submit').classList.add('hidden');
            }
        }

        function validateStep() {
            const errorDiv = document.getElementById('error-msg');
            let msg = "";

            if (currentStep === 1) {
                const phoneRegex = /^010-\d{4}-\d{4}$/;
                if (!phoneRegex.test(formData.phone)) msg = "휴대폰 번호를 010-0000-0000 형식으로 정확히 입력해주세요.";
                else if (!formData.regionDo || !formData.regionSi) msg = "지역을 모두 선택해주세요.";
            } else if (currentStep === 2) {
                if (!formData.userType) msg = "고객 구분을 선택해주세요.";
            } else if (currentStep === 3) {
                if (!formData.timeline) msg = "시공 시기를 선택해주세요.";
            } else if (currentStep === 4) {
                if (!formData.liftingType) msg = "양중(자재반입) 환경을 선택해주세요.";
            } else if (currentStep === 5) {
                if (!formData.operationType) msg = "구동 방식을 선택해주세요.";
                else if (!formData.width || !formData.projection) msg = "가로, 세로 사이즈를 입력해주세요.";
            } else if (currentStep === 6) {
                if (formData.optionGlass === '') msg = "글라스 도어 옵션을 반드시 선택해주세요 (설치 안함 포함)";
            }

            if (msg) {
                errorDiv.textContent = msg;
                errorDiv.classList.remove('hidden');
                return false;
            }
            return true;
        }

        function clearError() {
            document.getElementById('error-msg').classList.add('hidden');
        }

        function nextStep() {
            if (validateStep()) {
                currentStep++;
                updateStepUI();
                clearError();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepUI();
                clearError();
            }
        }

        // ================= 계산 로직 =================

        function calcPrice(w, p, operationType) {
            const isManual = operationType === 'manual';
            // 최대 사이즈 정의
            const MAX_W = 4000;
            const MAX_P = isManual ? 5400 : 5925; // 수동 5.4m, 전동 5.925m
            
            // 입력값 (mm 변환)
            const inputW = Math.round(parseFloat(w) * 1000);
            const inputP = Math.round(parseFloat(p) * 1000);

            // 적용값 (최대 사이즈로 제한, Cap)
            let appliedW = inputW;
            let appliedP = inputP;
            let isCapped = false;

            if (inputW > MAX_W || inputP > MAX_P) {
                isCapped = true;
                appliedW = Math.min(inputW, MAX_W);
                appliedP = Math.min(inputP, MAX_P);
            }

            // 이제 "무조건 1개"로 가정하고 계산
            const unitW = appliedW;
            const unitP = appliedP;
            const totalUnits = 1;

            // 가격표 조회
            const table = isManual ? oasisManualPriceTable : oasisElectricPriceTable;
            const pivotKeys = Object.keys(table).map(Number).sort((a,b)=>a-b);
            
            // Projection(돌출)에 맞는 행 찾기
            let matchedPivot = pivotKeys.find(pivot => pivot >= unitP);
            if (!matchedPivot) matchedPivot = pivotKeys[pivotKeys.length - 1]; // Max value fallback

            // Width(가로)에 맞는 열 인덱스 찾기
            const getSpanIndex = (span) => {
                if (span <= 1000) return 0;
                if (span <= 1500) return 1;
                if (span <= 2000) return 2;
                if (span <= 2500) return 3;
                if (span <= 3000) return 4;
                if (span <= 3500) return 5;
                return 6; // 4000
            };

            const spanIdx = getSpanIndex(unitW);
            const unitPrice = table[matchedPivot][spanIdx];
            
            return {
                unitPrice,
                totalUnits,
                unitW,
                unitP,
                totalBasePrice: unitPrice, // 1개이므로 unitPrice가 총 가격
                isCapped
            };
        }

        async function calculateQuote() {
            if (!validateStep()) return;

            const btn = document.getElementById('btn-submit');
            const originalText = btn.innerHTML;
            btn.innerHTML = '전송중... <i data-lucide="loader" class="animate-spin"></i>';
            lucide.createIcons();
            btn.disabled = true;

            try {
                // 1. 방향 최적화 로직 (가로/세로 Swap 비교)
                // (1) 원본 입력대로 계산
                const resultOriginal = calcPrice(formData.width, formData.projection, formData.operationType);
                // (2) 돌려서 계산
                const resultSwapped = calcPrice(formData.projection, formData.width, formData.operationType);

                let finalCalc = resultOriginal;
                let isSwapped = false;

                // 조건: 돌린 것이 더 넓은 유효 면적을 제공하면 Swap (단, 가격이 더 싸면 Swap)
                // 현재 로직: 넓은 면적 우선 -> 동일하면 가격 싼 거
                const areaOriginal = resultOriginal.unitW * resultOriginal.unitP;
                const areaSwapped = resultSwapped.unitW * resultSwapped.unitP;

                if (areaSwapped > areaOriginal) {
                    finalCalc = resultSwapped;
                    isSwapped = true;
                } else if (areaSwapped === areaOriginal) {
                    if (resultSwapped.totalBasePrice < resultOriginal.totalBasePrice) {
                        finalCalc = resultSwapped;
                        isSwapped = true;
                    }
                }

                // 2. 최종 합산
                let totalPrice = finalCalc.totalBasePrice;
                let optionDetails = [];
                const isManual = formData.operationType === 'manual';

                if (formData.optionLed) {
                    const ledCost = isManual ? 1000000 : 500000;
                    totalPrice += (ledCost * finalCalc.totalUnits); // totalUnits is always 1
                    optionDetails.push({ name: `LED 조명 옵션 (${isManual ? '수동형' : '전동형'})`, cost: ledCost });
                }

                if (formData.optionGlass === 'with') {
                    optionDetails.push({ name: '글라스 도어 (상세 실측 후 확정)', cost: 0, note: '별도 견적' });
                }

                if (formData.optionDeck) {
                    optionDetails.push({ name: '데크 시공 (현장 확인 후 견적)', cost: 0, note: '별도 견적' });
                }

                // 운임 계산
                let freight = 300000;
                if (['제주특별자치도'].includes(formData.regionDo)) freight = 1800000;
                else if (['경상북도','경상남도','부산광역시','울산광역시','대구광역시'].includes(formData.regionDo)) freight = 500000;
                else if (['전라남도','전북특별자치도','광주광역시'].includes(formData.regionDo)) freight = 500000;
                
                const labor = 800000; // 고정 (1식)
                totalPrice += (freight + labor);

                if (['ladder', 'crane', 'long_carry'].includes(formData.liftingType)) {
                    optionDetails.push({ name: '양중비 (사다리차/크레인/소운반)', cost: 0, note: '별도 견적' });
                }

                const quoteResult = {
                    totalPrice: totalPrice,
                    isSwapped: isSwapped,
                    isCapped: finalCalc.isCapped,
                    breakdown: {
                        totalUnits: finalCalc.totalUnits,
                        unitW: finalCalc.unitW,
                        unitP: finalCalc.unitP,
                        freight,
                        labor,
                        options: optionDetails
                    }
                };

                // 3. 이메일 발송
                await sendEmail(quoteResult);

                // 4. 모달 표시
                showModal(quoteResult);

            } catch (err) {
                console.error(err);
                alert('오류가 발생했습니다: ' + err.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
                setTimeout(() => lucide.createIcons(), 100);
            }
        }

        async function sendEmail(quoteData) {
            const templateParams = {
                to_name: "관리자",
                from_name: formData.phone,
                message: `
[테라까사 견적 상세]
--------------------------------
■ 고객 정보
- 연락처: ${formData.phone}
- 지역: ${formData.regionDo} ${formData.regionSi}
- 구분: ${formData.userType}

■ 시공 정보
- 시기: ${formData.timeline}
- 입력 사이즈: ${formData.width}m x ${formData.projection}m
- 적용 모델: ${formData.operationType === 'manual' ? '수동(Manual)' : '전동(Electric)'}
${quoteData.isSwapped ? '※ 최적 견적을 위해 가로/세로 방향이 변경 적용되었습니다.' : ''}
${quoteData.isCapped ? '※ 최대 규격을 초과하여 최대 사이즈 기준으로 산출되었습니다.' : ''}

■ 옵션 및 금액
- 선택옵션: ${formData.optionLed ? 'LED ' : ''}${formData.optionGlass !== 'none' ? '글라스도어 ' : ''}${formData.optionDeck ? '데크' : ''}
- 총 견적가: ${quoteData.totalPrice.toLocaleString()}원
--------------------------------
                `
            };

            try {
                await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
                console.log("Email Sent");
            } catch (error) {
                console.error("Email Failed", error);
            }
        }

        function showModal(result) {
            document.getElementById('modal-overlay').classList.remove('hidden');
            
            const displayPrice = Math.round(result.totalPrice / 10000) * 10000 < result.totalPrice 
                ? (Math.round(result.totalPrice / 10000) * 10000).toLocaleString() 
                : result.totalPrice.toLocaleString();
            document.getElementById('result-total-price').textContent = `${displayPrice}원~`;

            // 메시지 표시 로직
            const swapMsg = document.getElementById('result-swapped-msg');
            const capMsg = document.getElementById('result-cap-msg');
            
            // 초기화
            if(swapMsg) swapMsg.classList.add('hidden');
            if(capMsg) capMsg.classList.add('hidden');

            if (result.isCapped) {
                if(capMsg) capMsg.classList.remove('hidden');
            } 
            
            // Allow both messages to show if needed
            if (result.isSwapped) {
                if(swapMsg) {
                    swapMsg.classList.remove('hidden');
                    document.getElementById('result-swapped-text').innerHTML = 
                        `입력하신 사이즈(${formData.width}m x ${formData.projection}m)보다 <span class="font-bold underline">방향을 변경하여 시공(${formData.projection}m x ${formData.width}m)</span>하는 것이 더 경제적이라 시스템이 자동으로 최적 견적을 산출했습니다.`;
                }
            }

            // 상세 내역
            const detailsHtml = `
                <div class="flex justify-between border-b pb-2">
                    <span class="text-gray-500">고객명 / 연락처</span>
                    <span class="font-bold">${formData.phone}</span>
                </div>
                <div class="flex justify-between border-b pb-2">
                    <span class="text-gray-500">설치 지역</span>
                    <span class="font-bold">${formData.regionDo} ${formData.regionSi}</span>
                </div>
                <div class="flex justify-between border-b pb-2">
                    <span class="text-gray-500">선택 모델</span>
                    <span class="font-bold text-tc-olive">${formData.operationType === 'manual' ? 'OASIS 수동' : 'OASIS 전동'}</span>
                </div>
                <div class="flex justify-between border-b pb-2">
                    <span class="text-gray-500">제품 규격 ${result.isSwapped ? '(최적화됨)' : ''}</span>
                    <span class="font-bold">${result.breakdown.unitW} x ${result.breakdown.unitP} (mm)</span>
                </div>
                <div class="flex justify-between border-b pb-2">
                    <span class="text-gray-500">수량</span>
                    <span class="font-bold">${result.breakdown.totalUnits} Set</span>
                </div>
                ${result.breakdown.options.map(opt => `
                    <div class="flex justify-between border-b pb-2 text-gray-600">
                        <span>+ ${opt.name}</span>
                        <span>${opt.cost > 0 ? '₩ ' + opt.cost.toLocaleString() : opt.note}</span>
                    </div>
                `).join('')}
                <div class="flex justify-between border-b pb-2 text-gray-600">
                    <span>+ 기본 시공/운임비</span>
                    <span>₩ ${(result.breakdown.labor + result.breakdown.freight).toLocaleString()}</span>
                </div>
            `;
            document.getElementById('result-details').innerHTML = detailsHtml;
            
            setTimeout(() => lucide.createIcons(), 50);
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
        }
    </script>
</body>
</html>
